# Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.


## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.
### Решение 
### **Предлагаемое решение:**

Для организации процесса разработки в микросросервисной архитектуре хранение исходного кода, непрерывная интеграция и непрерывная поставка, предлагается следующий стек технологий:

- **GitHub / GitLab (облачная версия)** – система контроля версий и хостинг репозиториев.
    
- **GitHub Actions / GitLab CI/CD** – инструменты для непрерывной интеграции и поставки (CI/CD).
    
- **HashiCorp Vault** – для безопасного хранения секретов.
    
- **Docker Hub / GitLab Container Registry** – хранение Docker-образов.
    
- **Kubernetes (опционально, для развертывания агентов сборки)** – если требуется масштабируемая инфраструктура агентов.
    

### **Обоснование выбора:**

1. **Облачная система**
    
    - GitHub и GitLab предоставляют облачные решения с возможностью размещения приватных репозиториев.
        
    - GitHub Actions и GitLab CI/CD интегрированы с Git и позволяют запускать сборки автоматически.
        
2. **Система контроля версий Git**
    
    - Оба сервиса (GitHub и GitLab) как видно из названия и их предназначения  используют Git, что соответствует требованиям.
        
3. **Репозиторий на каждый сервис**
    
    - В микросервисной архитектуре каждый сервис должен быть в отдельном репозитории, что тоже поддерживается.
        
4. **Запуск сборки по событию (push, merge request)**
    
    - GitHub Actions и GitLab CI/CD позволяют настраивать триггеры на события в Git.
        
5. **Ручной запуск сборки с параметрами**
    
    - В GitLab есть возможность запускать пайплайны вручную с передачей переменных.
        
    - В GitHub Actions можно использовать `workflow_dispatch`.
        
6. **Настройки для каждой сборки**
    
    - Переменные окружения и секреты можно задавать на уровне репозитория или пайплайна.
        
7. **Шаблоны конфигураций сборки**
    
    - GitLab позволяет использовать `include` и шаблоны `.gitlab-ci.yml`.
        
    - GitHub Actions поддерживает шаблоны через `reusable workflows`.
        
8. **Безопасное хранение секретов**
    
    - GitHub Secrets и GitLab CI/CD Variables шифруют данные.
        
    - Для более сложных сценариев можно использовать HashiCorp Vault.
        
9. **Несколько конфигураций сборки из одного репозитория**
    
    - В GitLab можно использовать `rules` и `variables` для разных веток или тегов.
        
    - В GitHub Actions можно создавать несколько workflow-файлов.
        
10. **Кастомные шаги при сборке**
    
    - Оба инструмента позволяют описывать произвольные шаги в YAML.
        
11. **Собственные Docker-образы для сборки**
    
    - Можно использовать Docker Hub, GitLab Container Registry или GitHub Packages.
        
12. **Развертывание агентов на своих серверах**
    
    - GitLab Runner можно установить на собственные серверы.
        
    - GitHub Actions поддерживает self-hosted runners.
        
13. **Параллельный запуск сборок и тестов**
    
    - Оба инструмента поддерживают параллельные джобы (`parallel:` в GitLab, `matrix` в GitHub Actions).
## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.
### **Предлагаемое решение:**

Для централизованного сбора и анализа логов наилучшим выбором будет следующий стек:

- **Fluent Bit / Filebeat** – агенты для сбора и отправки логов.
    
- **Kafka (опционально)** – буферизация логов для гарантированной доставки.
    
- **Elasticsearch** – хранение и индексация логов.
    
- **Kibana** – визуализация и поиск по логам.
    


### **Обоснование выбора:**

1. **Сбор логов со всех хостов**
    
    - Fluent Bit и Filebeat поддерживают сбор из `stdout` и файлов.
        
2. **Минимальные требования к приложениям**
    
    - Fluent Bit легковесен и может работать даже на edge-устройствах.
        
3. **Гарантированная доставка**
    
    - Kafka может буферизировать логи при недоступности Elasticsearch.
        
4. **Поиск и фильтрация**
    
    - Elasticsearch предоставляет мощный поиск по индексированным данным.
        
5. **Пользовательский интерфейс (Kibana)**
    
    - Kibana позволяет создавать дашборды и сохранять поисковые запросы.
        
6. **Ссылки на сохранённые поиски**
    
    - В Kibana можно сохранять поиски и делиться ссылками.
## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.
### **Предлагаемое решение:**

Для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре предлагается следующий стек :

- **Prometheus** – сбор метрик.
    
- **Grafana** – визуализация.
    
- **Alertmanager** – алертинг.
    
- **Node Exporter** – метрики хостов.
    
- **cAdvisor / kube-state-metrics** – метрики контейнеров и Kubernetes.
    

### **Обоснование выбора:**

1. **Сбор метрик со всех хостов**
    
    - Node Exporter собирает CPU, RAM, Disk, Network.
        
2. **Метрики сервисов**
    
    - Prometheus может парсить `/metrics` эндпоинты сервисов.
        
    - cAdvisor дает данные по контейнерам.
        
3. **Специфичные метрики**
    
    - Разработчики могут добавлять кастомные метрики в Prometheus.
        
4. **Пользовательский интерфейс (Grafana)**
    
    - Поддержка сложных дашбордов и запросов.
        
5. **Настройка панелей**
    
    - В Grafana можно создавать и настраивать любые графики.
## Задача 4: Логи * (необязательная)

Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, пишут логи в stdout. 

Добавить в систему сервисы для сбора логов Vector + ElasticSearch + Kibana со всех сервисов, обеспечивающих работу API.

### Результат выполнения: 

docker compose файл, запустив который можно перейти по адресу http://localhost:8081, по которому доступна Kibana.
Логин в Kibana должен быть admin, пароль qwerty123456.


## Задача 5: Мониторинг * (необязательная)

Продолжить работу по задаче API Gateway: сервисы, используемые в задаче, предоставляют набор метрик в формате prometheus:

- сервис security по адресу /metrics,
- сервис uploader по адресу /metrics,
- сервис storage (minio) по адресу /minio/v2/metrics/cluster.

Добавить в систему сервисы для сбора метрик (Prometheus и Grafana) со всех сервисов, обеспечивающих работу API.
Построить в Graphana dashboard, показывающий распределение запросов по сервисам.

### Результат выполнения: 

docker compose файл, запустив который можно перейти по адресу http://localhost:8081, по которому доступна Grafana с настроенным Dashboard.
Логин в Grafana должен быть admin, пароль qwerty123456.

---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
